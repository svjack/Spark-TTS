peom_text = '''
哀江南赋并序
庾信
粤以戊辰之年，建亥之月，大盗移国，金陵瓦解。余乃窜身荒谷，公私涂炭。华阳奔命，有去无归，中兴道消，穷于甲戌。三日哭于都亭，三年囚于别馆。
天道周星，物极不反。傅燮之但悲身世，无所求生；袁安之每念王室，自然流涕。昔桓君山之志事，杜元凯之生平，并有著书，咸能自序。潘岳之文采，始述家风；陆机之词赋，先陈世德。信年始二毛，即逢丧乱，藐是流离，至于暮齿。燕歌远别，悲不自胜；楚老相逢，泣将何及！畏南山之雨，忽践秦庭；让东海之滨，遂餐周粟。下亭漂泊，高桥羁旅，楚歌非取乐之方，鲁酒无忘忧之用。追为此赋，聊以记言，不无危苦之辞，惟以悲哀为主。
日暮途远，人间何世。将军一去，大树飘零；壮士不还，寒风萧瑟。荆璧睨柱，受连城而见欺；载书横阶，捧珠盘而不定。锺仪君子，入就南冠之囚；季孙行人，留守西河之馆。申包胥之顿地，碎之以首；蔡威公之泪尽，加之以血。钓台移柳，非玉关之可望；华亭鹤唳，岂河桥之可闻。
孙策以天下为三分，众裁一旅；项籍用江东之子弟，人惟八千。遂乃分裂山河，宰割天下。岂有百万义师，一朝卷甲，芟夷斩伐，如草木焉？江淮无涯岸之阻，亭壁无藩篱之固。头会箕敛者，合从缔交；鉏耰棘矜者，因利乘便。将非江表王气，终于三百年乎？
是知并吞六合，不免轵道之灾；混一车书，无救平阳之祸。呜呼！山岳崩颓，既履危亡之运；春秋迭代，必有去故之悲。天意人事，可以凄怆伤心者矣。况复舟檝路穷，星汉非乘槎可上；风飚道阻，蓬莱无可到之期。穷者欲达其言，劳者须歌其事。陆士衡闻而抚掌，是所甘心；张平子见而陋之，固其宜矣。
我之掌庾承周，以世功而为族；经邦佐汉，用论道而当官。禀嵩华之玉石，润河洛之波澜。居负洛而重世，邑临河而晏安。逮永嘉之艰虞，始中原之乏主。民枕倚于墙壁，路交横于豺虎。值五马之南奔，逢三星之东聚。彼凌江而建国，始播迁于吾祖。分南阳而赐田，裂东岳而胙土。诛茅宋玉之宅，穿径临江之府。水木交运，山川崩竭。家有直道，人多全节。训子见于纯深，事君彰于义烈。新野有生祠之庙，河南有胡书之碣。况乃少微真人，天山逸民。阶庭空谷，门巷蒲轮。移谈讲树，就简书筠。降生世德，载诞贞臣。文词高于甲观，模楷盛于漳滨。嗟有道而无凤，叹非时而有麟。既奸回之赑匿，终不悦于仁人。
王子滨洛之岁，兰成射策之年，始含香于建礼，仍矫翼于崇贤。游洊雷之讲肆，齿明离之胄筵。既倾蠡而酌海，遂测管以窥天。方塘水白，钓渚池圆。侍戎韬于武帐，听雅曲于文弦。乃解悬而通籍，遂崇文而会武。居笠毂而掌兵，出兰池而典午。论兵于江汉之君，拭玉于西河之主。
于时朝野欢娱，池台钟鼓。里为冠盖，门成邹鲁。连茂苑于海陵，跨横塘于江浦。东门则鞭石成桥，南极则铸铜为柱。树则园植万株，竹则家封千户。西賮浮玉，南琛没羽。吴歈越吟，荆艳楚舞。草木之遇阳春，鱼龙之逢风雨。五十年中，江表无事。王歙为和亲之侯，班超为定远之使。马武无预于甲兵，冯唐不论于将帅。岂知山岳暗然，江湖潜沸。渔阳有闾左戍卒，离石有将兵都尉。
天子方删诗书，定礼乐。设重云之讲，开士林之学。谈劫烬之灰飞，辩常星之夜落。地平鱼齿，城危兽角。卧刁斗于荥阳，绊龙媒于平乐。宰衡以干戈为儿戏，缙绅以清谈为庙略。乘渍水而胶船，驭奔驹以朽索。小人则将及水火，君子则方成猿鹤。弊箄不能救盐池之鹹，阿胶不能止黄河之浊。既而鲂鱼頳尾，四郊多垒。殿狎江鸥，宫鸣野雉。湛卢去国，艅艎失水。见被发于伊川，知百年而为戎矣。
彼奸逆之炽盛，久游魂而放命。大则有鲸有鲵，小则为枭为獍。负其牛羊之力，凶其水草之性。非玉烛之能调，岂璿玑之可正。值天下之无为，尚有欲于羁縻。饮其琉璃之酒，赏其虎豹之皮。见胡桐于大夏，识鸟卵于条支。豺牙密厉，虺毒潜吹。轻九鼎而欲问，闻三川而遂窥。
始则王子召戎，奸臣介胄。既官政而离逿，遂师言而泄漏。望廷尉之逋囚，反淮南之穷寇。飞狄泉之苍鸟，起横江之困兽。地则石鼓鸣山，天则金精动宿。北阙龙吟，东陵麟斗。尔乃桀黠横扇，凭陵畿甸。拥狼望于黄图，填卢山于赤县。青袍如草，白马如练。天子履端废朝，单于长围高宴。两观当戟，千门受箭。白虹贯日，苍鹰击殿。竟遭夏台之祸，遂视尧城之变。官守无奔问之人，干戚非平戎之战。陶侃则空装米船，顾荣则虚摇羽扇。
将军死绥，路绝重围。烽随星落，书逐鸢飞。遂乃韩分赵裂，鼓卧旗折。失群班马，迷轮乱辙。猛士婴城，谋臣卷舌。昆阳之战象走林，常山之阵蛇奔穴。五郡则兄弟相悲，三州则父子离别。
护军慷慨，忠能死节。三世为将，终于此灭。济阳忠壮，身参末将。兄弟三人，义声俱唱。主辱臣死，名存身丧。狄人归元，三军凄怆。尚书多算，守备是长。云梯可拒，地道能防。有齐将之闭壁，无燕师之卧墙。大事去矣，人之云亡。申子奋发，勇气咆勃。实总元戎，身先士卒。胄落鱼门，兵填马窟。屡犯通中，频遭刮骨。功业夭枉，身名埋没。
或以隼翼鷃披，虎威狐假。霑渍锋镝，脂膏原野。兵弱虏彊，城孤气寡。闻鹤唳而心惊，听胡笳而泪下。据神亭而亡戟，临横江而弃马。崩于钜鹿之沙，碎于长平之瓦。
于是桂林颠覆，长洲麋鹿。溃溃沸腾，茫茫墋黩。天地离阻，人神怨酷。晋郑靡依，鲁卫不睦。竞动天关，争回地轴。探雀鷇而未饱，待熊蹯而讵熟。乃有车侧郭门，筋悬庙屋。鬼同曹社之谋，人有秦庭之哭。
余乃假刻玺于关塞，称使者之酬对。逢鄂坂之讥嫌，值耏门之征税。乘白马而不前，策青骡而转碍。吹落叶之扁舟，飘长风于上游。彼锯牙而勾爪，又巡江而习流。排青龙之战舰，斗飞燕之船楼。张辽临于赤壁，王濬下于巴丘。乍风惊而射火，或箭重而回舟。未辨声于黄盖，已先沈于杜侯。落帆黄鹤之浦，藏船鹦鹉之洲。路已分于湘汉，星犹看于斗牛。
若乃阴陵失路，钓台斜趣。望赤岸而霑衣，舣乌江而不度。雷池栅浦，鹊陵焚戍。旅舍无烟，巢禽失树。谓荆衡之杞梓，庶江汉之可恃。淮海维扬，三千馀里。过漂渚而寄食，托芦中而度水。届于七泽，滨于十死。嗟天保之未定，见殷忧之方始。本不达于危行，又无情于禄仕。谬掌卫于中军，滥尸丞于御史。
信生世等于龙门，辞亲同于河洛。奉立身之遗训，受成书之顾托。昔三世而无惭，今七叶而始落。泣风雨于梁山，惟枯鱼之衔索。入欹斜之小径，掩蓬藋之荒扉。就汀洲之杜若，待芦苇之单衣。
于时西楚霸王，剑及繁阳。鏖兵金匮，校战玉堂。苍鹰赤雀，铁舳牙樯。沈白马而誓众，负黄龙而度江。海潮迎舰，江萍送王。戎车屯于石城，戈船掩乎淮泗。诸侯则郑伯前驱，盟主则荀罃暮至。剖巢熏穴，奔魑走魅。埋长狄于驹门，斩蚩尤于中冀。然腹为灯，饮头为器。直虹贯垒，长星属地。昔之虎据龙盘，加以黄旗紫气，莫不随狐兔而窟穴，与风尘而殄瘁。
西瞻博望，北临玄圃。月榭风台，池平树古。倚弓于玉女窗扉，系马于凤凰楼柱。仁寿之镜徒悬，茂陵之书空聚。若夫立德立言，谟明夤亮。声超于系表，道高于河上。既不遇于浮丘，遂无言于师旷。指爱子而托人，知西陵而谁望。非无北阙之兵，犹有云台之仗。司徒之表里经纶，狐偃之惟王实勤。横雕戈而对霸主，执金鼓而问贼臣。平吴之功，壮于杜元凯；王室是赖，深于温太真。始则地名全节，终以山称枉人。南阳校书，去之已远。上蔡逐猎，知之何晚。镇北之负誉矜前，风飚懔然。水神遭箭，山灵见鞭。是以蛰熊伤马，浮蛟没船。才子并命，俱非百年。
中宗之夷凶静乱，大雪冤耻。去代邸而承基，迁唐郊而纂祀。反旧章于司隶，归馀风于正始。沉猜则方逞其欲，藏疾则自矜于己。天下之事没焉，诸侯之心摇矣。既而齐交北绝，秦患西起。况背关而怀楚，异端委而开吴。驱绿林之散卒，拒骊山之叛徒。营军梁溠，蒐乘巴渝。问诸淫昏之鬼，求诸厌劾之巫。荆门遭廪延之戮，夏口滥逵泉之诛。蔑因亲于教爱，忍和乐于弯弧。慨无谋于肉食，非所望于论都。未深思于五难，先自擅于三端。登阳城而避险，卧砥柱而求安。既言多于忌刻，实志勇于刑残。但坐观于时变，本无情于急难。地为黑子，城犹弹丸。其怨则黩，其盟则寒。岂冤禽之能塞海，非愚叟之可移山。况以沴气朝浮，妖精夜殒。赤鸟则三朝夹日，苍云则七重围轸。亡吴之岁既穷，入郢之年斯尽。
周含郑怒，楚结秦冤。有南风之不竞，值西邻之责言。俄而梯冲乱舞，冀马云屯。俴秦车于畅毂，沓汉鼓于雷门。下陈仓而连弩，度临晋而横船。虽复楚有七泽，人称三户。箭不丽于六麋，雷无惊于九虎。辞洞庭兮落木，去涔阳兮极浦。炽火兮焚旗，贞风兮害蛊。乃使玉轴扬灰，龙文斫柱。下江馀城，长林故营。徒思箝马之秣，未见烧牛之兵。章曼支以毂走，宫之奇以族行。河无冰而马度，关未晓而鸡鸣。忠臣解骨，君子吞声。章华望祭之所，云梦伪游之地。荒谷缢于莫敖，冶父囚乎群帅。硎阱折拉，鹰鹯批㩌。冤霜夏零，愤泉秋沸。城崩杞妇之哭，竹染湘妃之泪。
水毒秦泾，山高赵陉。十里五里，长亭短亭。饥随蛰燕，暗逐流萤。秦中水黑，关上泥青。于时瓦解冰泮，风飞电散。浑然千里，淄渑一乱。雪暗如沙，冰横似岸。逢赴洛之陆机，见离家之王粲。莫不闻陇水而掩泣，向关山而长叹。况复君在交河，妾在清波。石望夫而逾远，山望子而逾多。才人之忆代郡，公主之去清河。栩阳亭有离别之赋，临江王有愁思之歌。别有飘飖武威，羁旅金微。班超生而望反，温序死而思归。李陵之双凫永去，苏武之一雁空飞。
昔江陵之中否，乃金陵之祸始。虽借人之外力，实萧墙之内起。拨乱之主忽焉，中兴之宗不祀。伯兮叔兮，同见戮于犹子。荆山鹊飞而玉碎，随岸蛇生而珠死。鬼火乱于平林，殇魂惊于新市。梁故丰徙，楚实秦亡。不有所废，其何以昌。有妫之后，遂育于姜。输我神器，居为让王。天地之大德曰生，圣人之大宝曰位。用无赖之子弟，举江东而全弃。惜天下之一家，遭东南之反气。以鹑首而赐秦，天何为而此醉！
且夫天道回旋，民生预焉。余烈祖于西晋，始流播于东川。洎余身而七叶，又遭时而北迁。提挈老幼，关河累年。死生契阔，不可问天。况复零落将尽，灵光岿然。日穷于纪，岁将复始。逼切危虑，端忧暮齿。践长乐之神皋，望宣平之贵里。渭水贯于天门，骊山回于地市。幕府大将军之爱客，丞相平津侯之待士。见钟鼎于金、张，闻弦歌于许、史。岂知灞陵夜猎，犹是故时将军；咸阳布衣，非独思归王子。
'''

pip install moviepy==1.0.3

from moviepy.editor import VideoFileClip
import numpy as np

def process_sliced_video(input_path, output_path, start_time, end_time, max_frames=None):
    """
    先切片后处理视频帧，将非白色像素变为黑色

    参数:
        input_path: 输入视频路径
        output_path: 输出视频路径
        start_time: 切片开始时间(秒)
        end_time: 切片结束时间(秒)
        max_frames: 最大处理帧数(可选)
    """
    # 1. 先进行视频切片
    clip = VideoFileClip(input_path).subclip(start_time, end_time)

    # 2. 定义帧处理函数
    frame_count = [0]  # 使用列表以便在闭包中修改

    def process_frame(frame):
        if max_frames is not None and frame_count[0] >= max_frames:
            return frame

        # 创建帧副本
        processed_frame = frame.copy()

        # 定义白色阈值并处理非白色像素
        white_threshold = 220
        non_white_mask = np.any(processed_frame < white_threshold, axis=-1)
        processed_frame[non_white_mask] = [0, 0, 0]

        frame_count[0] += 1
        return processed_frame

    # 3. 应用帧处理
    processed_clip = clip.fl_image(process_frame)

    # 4. 输出处理后的视频
    processed_clip.write_videofile(
        output_path,
        codec="libx264",
        audio_codec="aac",
        threads=4,  # 使用多线程加速
        preset="fast"  # 快速编码预设
    )

    # 释放资源
    clip.close()
    processed_clip.close()

#使用示例
process_sliced_video("阿摩朗读：《哀江南赋》——波澜壮阔，哀感顽艳，蔚为大观。.mp4",
                     "哀江南赋黑白_pre.mp4", 0, 60, max_frames=int(1e5))

from moviepy.editor import VideoFileClip
import numpy as np

def process_video_frames(input_path, output_path, max_frames=None):
    """
    处理视频帧，将非白色像素变为黑色

    参数:
        input_path: 输入视频路径
        output_path: 输出视频路径
        max_frames: 最大处理帧数(可选)
    """
    # 加载整个视频
    clip = VideoFileClip(input_path)

    # 定义帧处理函数
    frame_count = [0]  # 使用列表以便在闭包中修改

    def process_frame(frame):
        if max_frames is not None and frame_count[0] >= max_frames:
            return frame

        # 创建帧副本
        processed_frame = frame.copy()

        # 定义白色阈值并处理非白色像素
        white_threshold = 220
        non_white_mask = np.any(processed_frame < white_threshold, axis=-1)
        processed_frame[non_white_mask] = [0, 0, 0]

        frame_count[0] += 1
        return processed_frame

    # 应用帧处理
    processed_clip = clip.fl_image(process_frame)

    # 输出处理后的视频
    processed_clip.write_videofile(
        output_path,
        codec="libx264",
        audio_codec="aac",
        threads=4,  # 使用多线程加速
        preset="fast"  # 快速编码预设
    )

    # 释放资源
    clip.close()
    processed_clip.close()

process_video_frames("阿摩朗读：《哀江南赋》——波澜壮阔，哀感顽艳，蔚为大观。.mp4",
                     "哀江南赋黑白.mp4")

pip install imagehash

vim run_split.py

from moviepy.editor import VideoFileClip
import imagehash
from PIL import Image
import os
import cv2
from tqdm import tqdm

def video_segmentation(input_video, output_dir):
    # 创建输出目录
    os.makedirs(output_dir, exist_ok=True)

    # 读取视频
    clip = VideoFileClip(input_video)
    fps = clip.fps
    duration = clip.duration
    total_frames = int(duration * fps)

    # 初始化变量
    segment_start = 0
    prev_hash = None
    segment_index = 0
    cap = cv2.VideoCapture(input_video)

    # 进度条初始化
    with tqdm(total=total_frames, desc="Processing Frames") as pbar:
        for frame_idx in range(total_frames):
            ret, frame = cap.read()
            if not ret:
                break

            # 转换为PIL图像并计算哈希
            pil_image = Image.fromarray(cv2.cvtColor(frame, cv2.COLOR_BGR2RGB))
            current_hash = imagehash.phash(pil_image)

            # 首帧处理
            if prev_hash is None:
                prev_hash = current_hash
                continue

            # 计算汉明距离
            hamming_distance = current_hash - prev_hash

            # 触发分割条件
            if hamming_distance > 5:
                segment_end = frame_idx / fps
                subclip = clip.subclip(segment_start, segment_end)
                # 使用零填充的4位数字命名
                output_path = os.path.join(output_dir, f"segment_{segment_index:09d}.mp4")
                subclip.write_videofile(output_path, codec='libx264')

                # 重置参数
                segment_start = segment_end
                segment_index += 1

            prev_hash = current_hash
            pbar.update(1)

        # 保存最后一段
        if segment_start < duration:
            subclip = clip.subclip(segment_start, duration)
            # 使用零填充的4位数字命名
            output_path = os.path.join(output_dir, f"segment_{segment_index:09d}.mp4")
            subclip.write_videofile(output_path, codec='libx264')

    cap.release()
    clip.close()

video_segmentation("哀江南赋黑白.mp4", "black_white_full/")

pip install paddlepaddle-gpu
pip install paddleocr

sudo apt-get install libcudnn8
sudo apt-get install libcudnn8-dev

vim run_ocr.py

import os
import json
import tempfile
from moviepy.editor import VideoFileClip
from PIL import Image
from paddleocr import PaddleOCR

# Initialize OCR model
ocr = PaddleOCR(use_angle_cls=True, lang='ch')

# Create output directory if it doesn't exist
input_dir = "black_white_sp"
output_dir = "black_white_sp_ocr"
os.makedirs(output_dir, exist_ok=True)

# Define the frame percentages to extract
frame_percentages = [0.05, 0.25, 0.50, 0.75, 0.95]

# Process each video in the input directory
for video_file in os.listdir(input_dir):
    if video_file.endswith(".mp4"):
        video_path = os.path.join(input_dir, video_file)

        # Initialize result dictionary for this video
        video_result = {
            "video_name": video_file,
            "frames": []
        }

        try:
            # Load the video
            clip = VideoFileClip(video_path)
            duration = clip.duration

            # Get frames at specified percentages
            for percentage in frame_percentages:
                frame_time = duration * percentage
                try:
                    # Get frame and save as temporary image file
                    frame = clip.get_frame(frame_time)
                    img = Image.fromarray(frame)

                    # Create temporary file for the frame
                    with tempfile.NamedTemporaryFile(suffix='.png', delete=False) as temp_file:
                        temp_path = temp_file.name
                        img.save(temp_path, format='PNG')

                    # Perform OCR using the temporary file path
                    result = ocr.ocr(temp_path, cls=True)

                    # Store results
                    frame_data = {
                        "time_percentage": percentage,
                        "time_seconds": frame_time,
                        "ocr_result": result
                    }
                    video_result["frames"].append(frame_data)

                    # Clean up temporary file
                    os.unlink(temp_path)

                except Exception as frame_error:
                    print(f"Error processing frame at {percentage*100}% of {video_file}: {frame_error}")
                    continue

        except Exception as video_error:
            print(f"Error processing video {video_file}: {video_error}")
            continue

        finally:
            # Ensure the clip is closed
            if 'clip' in locals():
                clip.close()

        # Save results to JSON file
        output_file = os.path.join(output_dir, f"{os.path.splitext(video_file)[0]}.json")
        with open(output_file, 'w', encoding='utf-8') as f:
            json.dump(video_result, f, ensure_ascii=False, indent=2)

        print(f"Processed {video_file} and saved results to {output_file}")

print("All videos processed.")

import pandas as pd
pd.DataFrame(
    pd.read_json("black_white_sp_ocr/segment_000000015.json")["frames"].values.tolist()
)["ocr_result"].map(lambda x: x[0][-1][-1])


import re

def split_poem_sentences(poem_text):
    # 正则表达式匹配中文标点（逗号、句号、感叹号、问号、分号、换行符）
    pattern = r'([，。！？；\n])'
    # 在标点符号后添加特殊分隔符
    processed_text = re.sub(pattern, r'\1|||', poem_text)
    # 按分隔符拆分句子
    sentences = [s.strip() for s in processed_text.split('|||') if s.strip()]

    # 去除每句末尾的标点符号（如果存在）
    cleaned_sentences = []
    for sentence in sentences:
        if sentence and sentence[-1] in '，。！？；':  # 检查末尾是否为标点
            cleaned_sentences.append(sentence[:-1])  # 去掉最后一个字符
        else:
            cleaned_sentences.append(sentence)

    return cleaned_sentences

# 使用示例
sentences = split_poem_sentences(peom_text)

import pandas as pd
import numpy as np
s = pd.Series(sentences).map(lambda x: x.strip() if x.strip() else np.nan).dropna()

import pathlib
import pandas as pd
import shutil

def r_func(txt_path):
    with open(txt_path, "r", encoding="utf-8") as f:
        return f.read().strip()

def process_json_to_txt(json_path):
    """处理json文件并返回文本内容"""
    try:
        df = pd.DataFrame(pd.read_json(json_path)["frames"].values.tolist())
        text = ",".join(
            df["ocr_result"]
            .map(lambda x: x[0][-1][-1])
            .map(lambda t2: t2[0])
            .drop_duplicates()
            .values.tolist()
        )
        return text
    except Exception as e:
        print(f"Error processing {json_path}: {e}")
        return ""

def copy_and_process_files(mp4_dir, ocr_dir, output_dir):
    # 创建必要的目录
    output_path = pathlib.Path(output_dir)
    output_path.mkdir(parents=True, exist_ok=True)

    # 处理json文件并复制mp4文件
    file_pairs = []
    for json_path in pathlib.Path(ocr_dir).rglob("*.json"):
        # 生成对应的txt文件名
        stem = json_path.stem
        txt_path = output_path / f"{stem}.txt"

        # 处理json内容并写入txt文件
        text_content = process_json_to_txt(json_path)
        with open(txt_path, "w", encoding="utf-8") as f:
            f.write(text_content)

        # 查找对应的mp4文件
        mp4_file = pathlib.Path(mp4_dir) / f"{stem}.mp4"
        if mp4_file.exists():
            # 复制mp4文件到输出目录
            dest_mp4 = output_path / f"{stem}.mp4"
            shutil.copy2(mp4_file, dest_mp4)

            # 记录文件对
            file_pairs.append({
                "stem": stem,
                "video_path": dest_mp4,
                "text_path": txt_path
            })
        else:
            print(f"Warning: No matching mp4 file found for {stem}")

    return file_pairs

def generate_metadata(file_pairs, output_dir):
    metadata = []
    for pair in file_pairs:
        metadata.append({
            "file_name": pair["video_path"].name,
            "prompt": r_func(pair["text_path"])
        })

    # 保存结果到CSV
    output_path = pathlib.Path(output_dir) / "metadata.csv"
    pd.DataFrame(metadata).to_csv(output_path, index=False, encoding='utf-8-sig')
    print(f"Metadata generated at: {output_path}")

# 主流程
if __name__ == "__main__":
    # 输入文件夹
    mp4_dir = "Lament_for_the_South"
    ocr_dir = "Lament_for_the_South_ocr"

    # 输出文件夹
    output_dir = "Lament_for_the_South_PaddleOCR"

    # 1. 复制文件并处理json为txt
    file_pairs = copy_and_process_files(mp4_dir, ocr_dir, output_dir)

    # 2. 生成metadata.csv
    generate_metadata(file_pairs, output_dir)

    print("Processing completed!")

pd.read_csv("Lament_for_the_South_PaddleOCR/metadata.csv").sort_values("file_name").reset_index().iloc[:, 1:].to_csv("Lament_for_the_South_PaddleOCR/metadata.csv", index = False)

'''
---
configs:
- config_name: default
  data_files:
  - split: train
    path:
    - "*.mp4"
    - "metadata.csv"
---
'''

print(pd.read_csv("Lament_for_the_South_PaddleOCR/metadata.csv").to_markdown())


|     | file_name             | prompt                                                                |
|----:|:----------------------|:----------------------------------------------------------------------|
|   0 | segment_000000008.mp4 | 粤v戊辰之年,粤戊辰之年                                                |
|   1 | segment_000000009.mp4 | 建亥之月                                                              |
|   2 | segment_000000010.mp4 | 大盗福国,大盗衫国                                                     |
|   3 | segment_000000011.mp4 | 金陵瓦解                                                              |
|   4 | segment_000000012.mp4 | 余万窜身荒谷                                                          |
|   5 | segment_000000013.mp4 | 公私涂炭,华阳命                                                       |
|   6 | segment_000000014.mp4 | 有去无归                                                              |
|   7 | segment_000000015.mp4 | 中兴道销                                                              |
|   8 | segment_000000016.mp4 | 穷于甲成                                                              |
|   9 | segment_000000017.mp4 | 三日哭于都亭                                                          |
|  10 | segment_000000018.mp4 | 三年四于别馆                                                          |
|  11 | segment_000000019.mp4 | 天道周星                                                              |
|  12 | segment_000000020.mp4 | 物极不反                                                              |
|  13 | segment_000000021.mp4 | 傅變之但悲身世                                                        |
|  14 | segment_000000022.mp4 | 无处求生                                                              |
|  15 | segment_000000023.mp4 | 袁安之每念王室                                                        |
|  16 | segment_000000024.mp4 | 自然流涕                                                              |
|  17 | segment_000000025.mp4 | 昔桓君山之志事                                                        |
|  18 | segment_000000026.mp4 | 杜元凯之平生                                                          |
|  19 | segment_000000027.mp4 | 并有著书                                                              |
|  20 | segment_000000028.mp4 | 咸能自序                                                              |
|  21 | segment_000000029.mp4 | 潘岳之文采                                                            |
|  22 | segment_000000030.mp4 | 始述家风                                                              |
|  23 | segment_000000031.mp4 | 陆机之辩赋                                                            |
|  24 | segment_000000032.mp4 | 先陈世德                                                              |
|  25 | segment_000000033.mp4 | 信年始二毛                                                            |
|  26 | segment_000000034.mp4 | 即逢丧乱                                                              |
|  27 | segment_000000035.mp4 | 藐是流离                                                              |
|  28 | segment_000000036.mp4 | 至于暮齿                                                              |
|  29 | segment_000000037.mp4 | 燕歌远别                                                              |
|  30 | segment_000000038.mp4 | 悲不自胜                                                              |
|  31 | segment_000000039.mp4 | 楚老相逢                                                              |
|  32 | segment_000000040.mp4 | 泣将何及                                                              |
|  33 | segment_000000041.mp4 | 畏南山之雨                                                            |
|  34 | segment_000000042.mp4 | 忽践秦庭                                                              |
|  35 | segment_000000043.mp4 | 让东海之滨                                                            |
|  36 | segment_000000044.mp4 | 遂餐周票                                                              |
|  37 | segment_000000045.mp4 | 下亭漂泊,高桥羁旅                                                     |
|  38 | segment_000000046.mp4 | 楚歌非取乐之方                                                        |
|  39 | segment_000000047.mp4 | 鲁酒无忘忧之用                                                        |
|  40 | segment_000000048.mp4 | 追为此赋                                                              |
|  41 | segment_000000049.mp4 | 聊r记言,聊v记言                                                       |
|  42 | segment_000000050.mp4 | 不无危苦之辞                                                          |
|  43 | segment_000000051.mp4 | 惟v悲哀为主,惟r悲哀为主                                               |
|  44 | segment_000000052.mp4 | 日暮涂远                                                              |
|  45 | segment_000000053.mp4 | 人间何世                                                              |
|  46 | segment_000000054.mp4 | 将军一去                                                              |
|  47 | segment_000000055.mp4 | 大树票風零,大树票飄風零,大树飄零                                      |
|  48 | segment_000000056.mp4 | 壮士不还                                                              |
|  49 | segment_000000057.mp4 | 寒风萧瑟                                                              |
|  50 | segment_000000058.mp4 | 荆壁柱,荆壁睨柱                                                       |
|  51 | segment_000000059.mp4 | 受连城而见欺                                                          |
|  52 | segment_000000060.mp4 | 载书横阶                                                              |
|  53 | segment_000000061.mp4 | 捧珠盘而不定                                                          |
|  54 | segment_000000062.mp4 | 钟仪君子                                                              |
|  55 | segment_000000063.mp4 | 入就南冠之区                                                          |
|  56 | segment_000000064.mp4 | 季孔孙行人,季孙行人                                                   |
|  57 | segment_000000065.mp4 | 留守西河之馆                                                          |
|  58 | segment_000000066.mp4 | 申包背之顿地                                                          |
|  59 | segment_000000067.mp4 | 碎之V首,碎之首                                                        |
|  60 | segment_000000068.mp4 | 蔡威公之泪尽                                                          |
|  61 | segment_000000069.mp4 | 加之血                                                                |
|  62 | segment_000000070.mp4 | 钓台福柳                                                              |
|  63 | segment_000000071.mp4 | 非玉关之可望                                                          |
|  64 | segment_000000072.mp4 | 华亭鹤喉                                                              |
|  65 | segment_000000073.mp4 | 岂河桥之可闻                                                          |
|  66 | segment_000000074.mp4 | 孙策天下为三                                                          |
|  67 | segment_000000075.mp4 | 众才一旅                                                              |
|  68 | segment_000000076.mp4 | 项藉用江东之子弟                                                      |
|  69 | segment_000000077.mp4 | 人惟八千                                                              |
|  70 | segment_000000078.mp4 | 遂万少裂山河                                                          |
|  71 | segment_000000079.mp4 | 宰割天下                                                              |
|  72 | segment_000000080.mp4 | 岂有百万义师                                                          |
|  73 | segment_000000081.mp4 | 一朝卷甲                                                              |
|  74 | segment_000000082.mp4 | 艾夷斩伐,如草木焉                                                     |
|  75 | segment_000000083.mp4 | 江淮无涯岸之阻,亭壁无藩万之固                                         |
|  76 | segment_000000084.mp4 | 头会箕敛者                                                            |
|  77 | segment_000000085.mp4 | 合从缔交                                                              |
|  78 | segment_000000086.mp4 | 锄棱棘矜者                                                            |
|  79 | segment_000000087.mp4 | 因利乘便                                                              |
|  80 | segment_000000088.mp4 | 将非江表王气                                                          |
|  81 | segment_000000089.mp4 | 终于三百年子,终于三百年乎                                             |
|  82 | segment_000000090.mp4 | 是知并吞六合,是知并六合                                               |
|  83 | segment_000000091.mp4 | 不免积道之灾                                                          |
|  84 | segment_000000092.mp4 | 混一车书                                                              |
|  85 | segment_000000093.mp4 | 无救平阳之祸                                                          |
|  86 | segment_000000094.mp4 | 呜呼                                                                  |
|  87 | segment_000000095.mp4 | 山岳崩颜                                                              |
|  88 | segment_000000096.mp4 | 既履危亡之运                                                          |
|  89 | segment_000000097.mp4 | 春秋送代                                                              |
|  90 | segment_000000098.mp4 | 必有去故之悲                                                          |
|  91 | segment_000000099.mp4 | 天意人事                                                              |
|  92 | segment_000000100.mp4 | 可r凄怆伤心者矣                                                       |
|  93 | segment_000000101.mp4 | 况复舟路穷                                                            |
|  94 | segment_000000102.mp4 | 星汉非乘槎可上                                                        |
|  95 | segment_000000103.mp4 | 风飙道阻                                                              |
|  96 | segment_000000104.mp4 | 蓬莱无可到之期                                                        |
|  97 | segment_000000105.mp4 | 穷者欲达其言,劳者须歌其事                                             |
|  98 | segment_000000106.mp4 | 陆士衡闻而抚掌                                                        |
|  99 | segment_000000107.mp4 | 是所甘心                                                              |
| 100 | segment_000000108.mp4 | 张平子见而陋之                                                        |
| 101 | segment_000000109.mp4 | 固其宜矣                                                              |
| 102 | segment_000000111.mp4 | 我之掌庚承周                                                          |
| 103 | segment_000000112.mp4 | V世功而为族,v世功而为族                                               |
| 104 | segment_000000113.mp4 | 经邦佐汉                                                              |
| 105 | segment_000000114.mp4 | 用论道而当官                                                          |
| 106 | segment_000000115.mp4 | 禀嵩华之玉石                                                          |
| 107 | segment_000000116.mp4 | 润河洛之波澜                                                          |
| 108 | segment_000000117.mp4 | 居负洛而重世                                                          |
| 109 | segment_000000118.mp4 | 邑临河而宴安                                                          |
| 110 | segment_000000119.mp4 | 逮永嘉之艰虞                                                          |
| 111 | segment_000000120.mp4 | 始中原之之主                                                          |
| 112 | segment_000000121.mp4 | 民枕倚于墙壁                                                          |
| 113 | segment_000000122.mp4 | 路交横于射虎                                                          |
| 114 | segment_000000123.mp4 | 值五马之南奔                                                          |
| 115 | segment_000000124.mp4 | 逢三星之东聚                                                          |
| 116 | segment_000000125.mp4 | 彼凌江而建国                                                          |
| 117 | segment_000000126.mp4 | 始播迁于吾祖                                                          |
| 118 | segment_000000127.mp4 | 少南阳而赐田                                                          |
| 119 | segment_000000128.mp4 | 裂东岳而昨土                                                          |
| 120 | segment_000000129.mp4 | 诛茅宋玉之宅,穿径临江之府                                             |
| 121 | segment_000000130.mp4 | 水木交运                                                              |
| 122 | segment_000000131.mp4 | 山川崩竭                                                              |
| 123 | segment_000000132.mp4 | 家有直道                                                              |
| 124 | segment_000000133.mp4 | 人多全节                                                              |
| 125 | segment_000000134.mp4 | 训子见于纯深                                                          |
| 126 | segment_000000135.mp4 | 事君章于义烈                                                          |
| 127 | segment_000000136.mp4 | 新野有生祠之庙                                                        |
| 128 | segment_000000137.mp4 | 河南有胡书之碣                                                        |
| 129 | segment_000000138.mp4 | 况乃少微真人                                                          |
| 130 | segment_000000139.mp4 | 天山逸民                                                              |
| 131 | segment_000000140.mp4 | 阶庭空谷                                                              |
| 132 | segment_000000141.mp4 | 门巷蒲轮                                                              |
| 133 | segment_000000142.mp4 | 衫谈讲树,就简书筠                                                     |
| 134 | segment_000000143.mp4 | 降生世德                                                              |
| 135 | segment_000000144.mp4 | 载诞贞臣                                                              |
| 136 | segment_000000145.mp4 | 文词高于甲观                                                          |
| 137 | segment_000000146.mp4 | 楷模盛于漳滨,嗟有道而无风                                             |
| 138 | segment_000000147.mp4 | 叹非時而有麟                                                          |
| 139 | segment_000000148.mp4 | 既奸回之愛逆                                                          |
| 140 | segment_000000149.mp4 | 终不悦于仁人                                                          |
| 141 | segment_000000150.mp4 | 王子滨洛之岁                                                          |
| 142 | segment_000000151.mp4 | 兰成射策之年                                                          |
| 143 | segment_000000152.mp4 | 始舍香于建礼                                                          |
| 144 | segment_000000153.mp4 | 仍矫翼于崇贤                                                          |
| 145 | segment_000000154.mp4 | 游游雷之讲肆                                                          |
| 146 | segment_000000155.mp4 | 齿明离之胄,齿明离之胄延                                               |
| 147 | segment_000000156.mp4 | 既倾蠢而酌海                                                          |
| 148 | segment_000000157.mp4 | 遂测管而窥天                                                          |
| 149 | segment_000000158.mp4 | 方塘水白,钓诸地圆                                                     |
| 150 | segment_000000159.mp4 | 待戎韬于武帐,听雅曲丁文弦,听雅曲于文弦                                |
| 151 | segment_000000160.mp4 | 万解悬而通藉                                                          |
| 152 | segment_000000161.mp4 | 遂崇文而会武,居笠毂而掌兵                                             |
| 153 | segment_000000162.mp4 | 出兰地而典午                                                          |
| 154 | segment_000000163.mp4 | 论兵于江汉之君,论乓十江汉之君                                         |
| 155 | segment_000000164.mp4 | 拭玉于西河之主                                                        |
| 156 | segment_000000165.mp4 | 于時朝野欢娱                                                          |
| 157 | segment_000000166.mp4 | 地台钟鼓                                                              |
| 158 | segment_000000167.mp4 | 里为冠盖                                                              |
| 159 | segment_000000168.mp4 | 门成邹鲁                                                              |
| 160 | segment_000000169.mp4 | 连茂范于海陵                                                          |
| 161 | segment_000000170.mp4 | 跨横塘于江浦                                                          |
| 162 | segment_000000171.mp4 | 东门贝鞭石成桥                                                        |
| 163 | segment_000000172.mp4 | 南极铸铜为柱                                                          |
| 164 | segment_000000173.mp4 | 橘园植万株                                                            |
| 165 | segment_000000174.mp4 | 竹贝家封千户                                                          |
| 166 | segment_000000175.mp4 | 西浮玉,西购浮玉                                                       |
| 167 | segment_000000176.mp4 | 南璨没羽                                                              |
| 168 | segment_000000177.mp4 | 吴越吟,吴飲越吟                                                       |
| 169 | segment_000000178.mp4 | 荆艳楚舞                                                              |
| 170 | segment_000000179.mp4 | 草木之遇阳春                                                          |
| 171 | segment_000000180.mp4 | 鱼龙之逢风雨                                                          |
| 172 | segment_000000181.mp4 | 五十年中,江表无事                                                     |
| 173 | segment_000000182.mp4 | 王歌为和亲之候                                                        |
| 174 | segment_000000183.mp4 | 班超为定远之使                                                        |
| 175 | segment_000000184.mp4 | 马武无预于甲兵,冯唐不论于将帅,冯唐示论于将帅                          |
| 176 | segment_000000185.mp4 | 岂知山岳阁然                                                          |
| 177 | segment_000000186.mp4 | 江湖潜沸                                                              |
| 178 | segment_000000187.mp4 | 渔阳有间左成卒,渔阳有同左成卒                                         |
| 179 | segment_000000188.mp4 | 离石有将兵都尉                                                        |
| 180 | segment_000000189.mp4 | 天子方册诗书                                                          |
| 181 | segment_000000190.mp4 | 定礼乐                                                                |
| 182 | segment_000000191.mp4 | 设重云之讲                                                            |
| 183 | segment_000000192.mp4 | 开士林之学                                                            |
| 184 | segment_000000193.mp4 | 谈劫烧之灰飞                                                          |
| 185 | segment_000000194.mp4 | 辩常星之夜落                                                          |
| 186 | segment_000000195.mp4 | 地平鱼齿                                                              |
| 187 | segment_000000196.mp4 | 城危兽角                                                              |
| 188 | segment_000000197.mp4 | 卧刁斗于荣阳                                                          |
| 189 | segment_000000198.mp4 | 绊龙媒于平乐                                                          |
| 190 | segment_000000199.mp4 | 宰衡干戈为儿戏                                                        |
| 191 | segment_000000200.mp4 | 缙绅r清谈为庙略                                                       |
| 192 | segment_000000201.mp4 | 乘渍水r胶船,双奔驹朽索,驭奔驹村索                                     |
| 193 | segment_000000202.mp4 | 小人贝将及水火,小人将及水火                                           |
| 194 | segment_000000203.mp4 | 君子方成猿鹤                                                          |
| 195 | segment_000000204.mp4 | 淑算不能救盐地之咸,淑第不能救盐地之咸,敬第不能救盐地之咸              |
| 196 | segment_000000205.mp4 | 阿胶不能止黄河之浊                                                    |
| 197 | segment_000000206.mp4 | 既而鲂鱼颓尾,既而鲂鱼棘尾                                             |
| 198 | segment_000000207.mp4 | 四郊多垒                                                              |
| 199 | segment_000000208.mp4 | 殿押江鸥                                                              |
| 200 | segment_000000209.mp4 | 宫鸣野雉                                                              |
| 201 | segment_000000210.mp4 | 湛卢去国                                                              |
| 202 | segment_000000211.mp4 | 躲失水                                                                |
| 203 | segment_000000212.mp4 | 见被发于伊川                                                          |
| 204 | segment_000000213.mp4 | 知百年而为戎矣                                                        |
| 205 | segment_000000214.mp4 | 彼奸逆之炽盛,久游魂而放命                                             |
| 206 | segment_000000215.mp4 | 大贝有鲸有鲸,大贝有鲸有鲩                                             |
| 207 | segment_000000216.mp4 | 小为桑为境                                                            |
| 208 | segment_000000217.mp4 | 负其牛羊之力                                                          |
| 209 | segment_000000218.mp4 | 肆其水草之性                                                          |
| 210 | segment_000000219.mp4 | 非玉烛之能调                                                          |
| 211 | segment_000000220.mp4 | 岂璇玑之可正                                                          |
| 212 | segment_000000221.mp4 | 值天下之无为                                                          |
| 213 | segment_000000222.mp4 | 尚有欲于羁靡                                                          |
| 214 | segment_000000223.mp4 | 饮其琉璃之酒,赏其虎豹之皮                                             |
| 215 | segment_000000224.mp4 | 胡柯于大夏                                                            |
| 216 | segment_000000225.mp4 | 识鸟卵于条枝                                                          |
| 217 | segment_000000226.mp4 | 豺牙密方,豺牙密厉,射牙密厉                                            |
| 218 | segment_000000227.mp4 | 应毒潜吹,德毒潜吹                                                     |
| 219 | segment_000000228.mp4 | 轻九鼎而欲问                                                          |
| 220 | segment_000000229.mp4 | 闻三川而遂窥                                                          |
| 221 | segment_000000230.mp4 | 始王子召戎,始贝王子召戎                                               |
| 222 | segment_000000231.mp4 | 奸臣介胄                                                              |
| 223 | segment_000000232.mp4 | 既官政而离遏,遂师言而泄漏                                             |
| 224 | segment_000000233.mp4 | 望廷尉之浦区                                                          |
| 225 | segment_000000234.mp4 | 反淮南之穷寇                                                          |
| 226 | segment_000000235.mp4 | 出秋泉之苍鸟,起横江之困曾                                             |
| 227 | segment_000000236.mp4 | 地石鼓鸟山,地石鼓鸣鸟山                                               |
| 228 | segment_000000237.mp4 | 天金精动宿                                                            |
| 229 | segment_000000238.mp4 | 北阙龙吟                                                              |
| 230 | segment_000000239.mp4 | 东陵麟斗                                                              |
| 231 | segment_000000240.mp4 | 尔万架點构扇                                                          |
| 232 | segment_000000241.mp4 | 冯陵畿甸                                                              |
| 233 | segment_000000242.mp4 | 拥粮望于黄图                                                          |
| 234 | segment_000000243.mp4 | 填卢山于赤县                                                          |
| 235 | segment_000000244.mp4 | 青袍如草                                                              |
| 236 | segment_000000245.mp4 | 白马如练                                                              |
| 237 | segment_000000246.mp4 | 天子履端废朝                                                          |
| 238 | segment_000000247.mp4 | 单于长围高宴                                                          |
| 239 | segment_000000248.mp4 | 两观当戟,千门受箭                                                     |
| 240 | segment_000000249.mp4 | 白虹贯日                                                              |
| 241 | segment_000000250.mp4 | 苍鹰击殿                                                              |
| 242 | segment_000000251.mp4 | 竟遭夏台之祸                                                          |
| 243 | segment_000000252.mp4 | 终视尧城之变                                                          |
| 244 | segment_000000253.mp4 | 官守无奔问之人                                                        |
| 245 | segment_000000254.mp4 | 干戚非平戎之战,千戚非平戎之战                                         |
| 246 | segment_000000255.mp4 | 陶倪空争米船,顾荣虚摇羽扇                                             |
| 247 | segment_000000256.mp4 | 将军死绥                                                              |
| 248 | segment_000000257.mp4 | 路绝重围,烽随星落,书逐贰飞,书逐鳳飞                                   |
| 249 | segment_000000258.mp4 | 万韩少赵裂                                                            |
| 250 | segment_000000259.mp4 | 鼓卧旗折,失群班马                                                     |
| 251 | segment_000000260.mp4 | 迷轮乱辙                                                              |
| 252 | segment_000000261.mp4 | 士婴城,谋臣卷舌                                                       |
| 253 | segment_000000262.mp4 | 昆阳之战象走林,常山之阵蛇奔穴                                         |
| 254 | segment_000000263.mp4 | 五郡贝兄弟相悲                                                        |
| 255 | segment_000000264.mp4 | 三小州贝父子离别,三小州贝|父子离别,三州贝|父子离别,三小州贝丨父子离别 |
| 256 | segment_000000265.mp4 | 护军康既                                                              |
| 257 | segment_000000266.mp4 | 忠能死节                                                              |
| 258 | segment_000000267.mp4 | 三世为将                                                              |
| 259 | segment_000000268.mp4 | 终于此灭,济阳忠壮                                                     |
| 260 | segment_000000269.mp4 | 身参末将                                                              |
| 261 | segment_000000270.mp4 | 兄弟三人                                                              |
| 262 | segment_000000271.mp4 | 义声俱唱                                                              |
| 263 | segment_000000272.mp4 | 主辱臣死                                                              |
| 264 | segment_000000273.mp4 | 名存身表,名存身丧                                                     |
| 265 | segment_000000274.mp4 | 敌人归元                                                              |
| 266 | segment_000000275.mp4 | 三军凄怆,三军凄忙,尚书多算                                            |
| 267 | segment_000000276.mp4 | 守备是长,云梯可拒                                                     |
| 268 | segment_000000277.mp4 | 地道能防                                                              |
| 269 | segment_000000278.mp4 | 有齐将之闭壁                                                          |
| 270 | segment_000000279.mp4 | 无燕师之卧墙                                                          |
| 271 | segment_000000280.mp4 | 大事去矣                                                              |
| 272 | segment_000000281.mp4 | 人之云亡                                                              |
| 273 | segment_000000282.mp4 | 申子奋发                                                              |
| 274 | segment_000000283.mp4 | 勇气咆勃,勇气勃                                                       |
| 275 | segment_000000284.mp4 | 实总元戎                                                              |
| 276 | segment_000000285.mp4 | 身先士卒                                                              |
| 277 | segment_000000286.mp4 | 胄落鱼门                                                              |
| 278 | segment_000000287.mp4 | 兵填马窟,屡祀通中,频遭刮骨                                            |
| 279 | segment_000000288.mp4 | 功业天柱                                                              |
| 280 | segment_000000289.mp4 | 身名埋没                                                              |
| 281 | segment_000000290.mp4 | 或r<隼翼鹦披,或r隼翼鹦披,或r隼翼披                                    |
| 282 | segment_000000291.mp4 | 虎威孤假                                                              |
| 283 | segment_000000292.mp4 | 沾渍锋镝                                                              |
| 284 | segment_000000293.mp4 | 脂膏原野,兵弱虏强                                                     |
| 285 | segment_000000294.mp4 | 城孤气寡                                                              |
| 286 | segment_000000295.mp4 | 闻鹤喉而心惊                                                          |
| 287 | segment_000000296.mp4 | 听胡第而泪下                                                          |
| 288 | segment_000000297.mp4 | 拒神亭而亡载                                                          |
| 289 | segment_000000298.mp4 | 临横江而弃马                                                          |
| 290 | segment_000000299.mp4 | 萌于钜之沙,崩于钜鹿之沙,崩于钜之沙                                    |
| 291 | segment_000000300.mp4 | 碎于长平之瓦                                                          |
| 292 | segment_000000301.mp4 | 于是桂林颠覆                                                          |
| 293 | segment_000000302.mp4 | 长洲寨鹿,长洲麋鹿,长洲寨廊,长州寨鹿                                   |
| 294 | segment_000000303.mp4 | 溃溃沸腾                                                              |
| 295 | segment_000000304.mp4 | 茫茫默,茫茫场默,茫茫掺默,天地离阻                                     |
| 296 | segment_000000305.mp4 | 神人惨酷                                                              |
| 297 | segment_000000306.mp4 | 晋郑摩依                                                              |
| 298 | segment_000000307.mp4 | 鲁卫不睦,竞动天关                                                     |
| 299 | segment_000000308.mp4 | 争回地轴                                                              |
| 300 | segment_000000309.mp4 | 探雀殼而未饱                                                          |
| 301 | segment_000000310.mp4 | 待熊蟠而钜熟,待熊踏而追熟                                             |
| 302 | segment_000000311.mp4 | 万有车侧郭门                                                          |
| 303 | segment_000000312.mp4 | 筋悬庙屋                                                              |
| 304 | segment_000000313.mp4 | 鬼同曹社之谋                                                          |
| 305 | segment_000000314.mp4 | 人有秦庭之哭                                                          |
| 306 | segment_000000315.mp4 | 尔万假刻玺于关塞,尔乃假刻玺于关塞                                     |
| 307 | segment_000000316.mp4 | 称使者之州对                                                          |
| 308 | segment_000000317.mp4 | 逢鄂坂之讥嫌,逢坂之讥嫌                                               |
| 309 | segment_000000318.mp4 | 值耐门之征税                                                          |
| 310 | segment_000000319.mp4 | 乘白马而不前,策青骤而转碍,吹落叶之扁舟                                |
| 311 | segment_000000320.mp4 | 飄长风于上游                                                          |
| 312 | segment_000000321.mp4 | 彼锯牙而钩爪                                                          |
| 313 | segment_000000322.mp4 | 又循江而习流                                                          |
| 314 | segment_000000323.mp4 | 排青龙之战舰                                                          |
| 315 | segment_000000324.mp4 | 斗飞燕之船楼                                                          |
| 316 | segment_000000325.mp4 | 张辽临于赤壁                                                          |
| 317 | segment_000000326.mp4 | 王溶下于巴丘,王下于巴丘                                               |
| 318 | segment_000000327.mp4 | 下风惊而射火                                                          |
| 319 | segment_000000328.mp4 | 或箭重而沉舟                                                          |
| 320 | segment_000000329.mp4 | 未辩声于黄盖                                                          |
| 321 | segment_000000330.mp4 | 乙先坑于杜侯,已先沉于杜侯                                             |
| 322 | segment_000000331.mp4 | 落帆黄鹤之浦                                                          |
| 323 | segment_000000332.mp4 | 藏船鹦鹉之洲                                                          |
| 324 | segment_000000333.mp4 | 路已少于湘汉,路已少寸湘汉                                             |
| 325 | segment_000000334.mp4 | 星犹看于斗牛                                                          |
| 326 | segment_000000335.mp4 | 若万阴陵失路,钓台斜趣                                                 |
| 327 | segment_000000336.mp4 | 望赤壁而沾衣                                                          |
| 328 | segment_000000337.mp4 | 般鸟江而不渡                                                          |
| 329 | segment_000000338.mp4 | 雷地栅浦                                                              |
| 330 | segment_000000339.mp4 | 鹊陵楚成,旅舍无烟,巢禽无树                                            |
| 331 | segment_000000340.mp4 | 谓荆衡之杞梓                                                          |
| 332 | segment_000000341.mp4 | 庶江汉之可特                                                          |
| 333 | segment_000000342.mp4 | 淮海维扬                                                              |
| 334 | segment_000000343.mp4 | 三千徐里                                                              |
| 335 | segment_000000344.mp4 | 过漂诸而寄食                                                          |
| 336 | segment_000000345.mp4 | 托芦中而渡水                                                          |
| 337 | segment_000000346.mp4 | 届于七泽,滨于十死                                                     |
| 338 | segment_000000347.mp4 | 嗟天保之未定                                                          |
| 339 | segment_000000348.mp4 | 见殷优之方始                                                          |
| 340 | segment_000000349.mp4 | 本不达于危行                                                          |
| 341 | segment_000000350.mp4 | 又无情于禄仕                                                          |
| 342 | segment_000000351.mp4 | 谬掌卫于中军                                                          |
| 343 | segment_000000352.mp4 | 滥尸丞于御史                                                          |
| 344 | segment_000000353.mp4 | 信生世等于龙门                                                        |
| 345 | segment_000000354.mp4 | 辞亲同于河                                                            |
| 346 | segment_000000355.mp4 | 奉立身之遗训                                                          |
| 347 | segment_000000356.mp4 | 受成书之顾托                                                          |
| 348 | segment_000000357.mp4 | 昔三世而无惭                                                          |
| 349 | segment_000000358.mp4 | 今七叶而始落                                                          |
| 350 | segment_000000359.mp4 | 泣风雨丁梁山                                                          |
| 351 | segment_000000360.mp4 | 惟枯鱼之衔索                                                          |
| 352 | segment_000000361.mp4 | 入敬斜之小径                                                          |
| 353 | segment_000000362.mp4 | 掩蓬之荒扇                                                            |
| 354 | segment_000000363.mp4 | 就河洲之杜若,就汀洲之杜若                                             |
| 355 | segment_000000364.mp4 | 待芦苇之单衣                                                          |
| 356 | segment_000000365.mp4 | 于是西楚霸王                                                          |
| 357 | segment_000000366.mp4 | 剑及繁阳                                                              |
| 358 | segment_000000367.mp4 | 兵金園,校战玉堂                                                       |
| 359 | segment_000000368.mp4 | 苍鹰赤雀                                                              |
| 360 | segment_000000369.mp4 | 铁才墙,铁轴才墙                                                       |
| 361 | segment_000000370.mp4 | 沉白马而誓众                                                          |
| 362 | segment_000000371.mp4 | 负黄龙而渡江                                                          |
| 363 | segment_000000372.mp4 | 海潮迎舰                                                              |
| 364 | segment_000000373.mp4 | 江萍送王                                                              |
| 365 | segment_000000374.mp4 | 戎军屯于石城                                                          |
| 366 | segment_000000375.mp4 | 船掩于维泗,船掩于维酒泗                                               |
| 367 | segment_000000376.mp4 | 诸候郑伯前驱                                                          |
| 368 | segment_000000377.mp4 | 盟主荀暮至,盟主则荀暮至                                               |
| 369 | segment_000000378.mp4 | 剖巢熏穴                                                              |
| 370 | segment_000000379.mp4 | 奔走鬼,奔走鬼魅                                                       |
| 371 | segment_000000380.mp4 | 埋长秋于驹门                                                          |
| 372 | segment_000000381.mp4 | 斩岁尤于中冀,斩蛋尤于中冀                                             |
| 373 | segment_000000382.mp4 | 燃腹为灯                                                              |
| 374 | segment_000000383.mp4 | 饮头为器                                                              |
| 375 | segment_000000384.mp4 | 直虹贯垒,长星属地                                                     |
| 376 | segment_000000385.mp4 | 昔之虎踞龙盘                                                          |
| 377 | segment_000000386.mp4 | 加r黄旗紫气,加r<黄旗紫气                                              |
| 378 | segment_000000387.mp4 | 莫示随孤兔而密穴,莫不随孤兔而密穴,莫不随孤兔而窟穴                    |
| 379 | segment_000000388.mp4 | 与风尘而珍,与风尘而珍疼                                               |
| 380 | segment_000000389.mp4 | 西瞻博望                                                              |
| 381 | segment_000000390.mp4 | 北临玄圃                                                              |
| 382 | segment_000000391.mp4 | 月榭风台                                                              |
| 383 | segment_000000392.mp4 | 地平树古                                                              |
| 384 | segment_000000393.mp4 | 倚弓于玉女窗扇,系马于风皇楼柱                                         |
| 385 | segment_000000394.mp4 | 仁寿之镜徒悬,茂陵之书空聚                                             |
| 386 | segment_000000395.mp4 | 若夫立德立言                                                          |
| 387 | segment_000000396.mp4 | 谟明寅亮                                                              |
| 388 | segment_000000397.mp4 | 声超于系表                                                            |
| 389 | segment_000000398.mp4 | 道高于河上                                                            |
| 390 | segment_000000399.mp4 | 更不遇于浮丘                                                          |
| 391 | segment_000000400.mp4 | 遂无言于师                                                            |
| 392 | segment_000000401.mp4 | V爱子而托人,知西陵而谁望                                              |
| 393 | segment_000000402.mp4 | 非无北阙之兵                                                          |
| 394 | segment_000000403.mp4 | 犹有云台之仗                                                          |
| 395 | segment_000000404.mp4 | 司徒之表里经纶,孤倔之惟王实勤,横戈而对霸主                            |
| 396 | segment_000000405.mp4 | 执金鼓而问贼臣                                                        |
| 397 | segment_000000406.mp4 | 平吴之功                                                              |
| 398 | segment_000000407.mp4 | 壮于杜元凯                                                            |
| 399 | segment_000000408.mp4 | 王室是赖                                                              |
| 400 | segment_000000409.mp4 | 深于温太真,始贝|地名全节,终贝山称柱人                                 |
| 401 | segment_000000410.mp4 | 南阳校书                                                              |
| 402 | segment_000000411.mp4 | 去之已远                                                              |
| 403 | segment_000000412.mp4 | 上蔡逐措                                                              |
| 404 | segment_000000413.mp4 | 知之何晚                                                              |
| 405 | segment_000000414.mp4 | 镇北之负誉矜前                                                        |
| 406 | segment_000000415.mp4 | 风飙凛然,水神遭箭,山灵见鞭                                            |
| 407 | segment_000000416.mp4 | 是蛰熊伤马,是<蛰熊伤马                                                |
| 408 | segment_000000417.mp4 | 浮蚊没船                                                              |
| 409 | segment_000000418.mp4 | 才子并命,俱非百年                                                     |
| 410 | segment_000000419.mp4 | 中宗之夷凶靖乱                                                        |
| 411 | segment_000000420.mp4 | 大雪冤耻                                                              |
| 412 | segment_000000421.mp4 | 去代氏而承基,去代民而承基                                             |
| 413 | segment_000000422.mp4 | 迁唐郊而纂祀                                                          |
| 414 | segment_000000423.mp4 | 反旧章于司隶                                                          |
| 415 | segment_000000424.mp4 | 归徐风于正始                                                          |
| 416 | segment_000000425.mp4 | 沈精方其欲,沈精方逞其欲                                               |
| 417 | segment_000000426.mp4 | 藏疾自矜于已,藏疾则自矜于已                                           |
| 418 | segment_000000427.mp4 | 天下之事没焉,诸候之心摇矣                                             |
| 419 | segment_000000428.mp4 | 既而齐交北绝                                                          |
| 420 | segment_000000429.mp4 | 秦患西起                                                              |
| 421 | segment_000000430.mp4 | 况背关而不楚,异端委而开吴                                             |
| 422 | segment_000000431.mp4 | 驱绿林之散卒                                                          |
| 423 | segment_000000432.mp4 | 拒丽山之叛徒                                                          |
| 424 | segment_000000433.mp4 | 营军梁                                                                |
| 425 | segment_000000434.mp4 | 乘巴渝                                                                |
| 426 | segment_000000435.mp4 | 问诸淫昏之鬼                                                          |
| 427 | segment_000000436.mp4 | 求诸厌劾之符                                                          |
| 428 | segment_000000437.mp4 | 荆门遭厦延之戮                                                        |
| 429 | segment_000000438.mp4 | 夏口滥达泉之诛,夏口滥達泉之诛,夏口滥逵泉之诛                          |
| 430 | segment_000000439.mp4 | 因亲v<致爱,因亲v致爱,因亲r<致爱                                       |
| 431 | segment_000000440.mp4 | 忍和乐于弯张,既无谋于肉食                                             |
| 432 | segment_000000441.mp4 | 非所望于论都,未深思于五难                                             |
| 433 | segment_000000442.mp4 | 先自擅于三端                                                          |
| 434 | segment_000000443.mp4 | 登阳城而避险                                                          |
| 435 | segment_000000444.mp4 | 卧砥柱而求安                                                          |
| 436 | segment_000000445.mp4 | 既言多于忌刻                                                          |
| 437 | segment_000000446.mp4 | 实志勇而形残                                                          |
| 438 | segment_000000447.mp4 | 但坐观于时变                                                          |
| 439 | segment_000000448.mp4 | 本无情于急难                                                          |
| 440 | segment_000000449.mp4 | 地惟黑子                                                              |
| 441 | segment_000000450.mp4 | 城扰弹丸,其怨贝默,其盟寒                                              |
| 442 | segment_000000451.mp4 | 岂兔禽之能塞海,非愚叟之可福山                                         |
| 443 | segment_000000452.mp4 | 况渗气朝浮,况V渗气朝浮                                                |
| 444 | segment_000000453.mp4 | 妖精夜陨                                                              |
| 445 | segment_000000454.mp4 | 赤鸟三朝夹日,赤鸟见三朝夹日,苍云七重围轮,苍云贝七重围轮               |
| 446 | segment_000000455.mp4 | 亡吴之岁既穷                                                          |
| 447 | segment_000000456.mp4 | 入郢之年斯尽                                                          |
| 448 | segment_000000457.mp4 | 周含郑怒,周含郑,周舍郑                                                |
| 449 | segment_000000458.mp4 | 楚结秦冤                                                              |
| 450 | segment_000000459.mp4 | 有南风之不竞                                                          |
| 451 | segment_000000460.mp4 | 值西邻之责言                                                          |
| 452 | segment_000000461.mp4 | 俄而梯冲乱舞                                                          |
| 453 | segment_000000462.mp4 | 冀马云屯                                                              |
| 454 | segment_000000463.mp4 | 秦车于畅毂,俄秦车于畅毂                                               |
| 455 | segment_000000464.mp4 | 沓汉鼓于雷门                                                          |
| 456 | segment_000000465.mp4 | 下陈仓而连努                                                          |
| 457 | segment_000000466.mp4 | 渡临晋而横船                                                          |
| 458 | segment_000000467.mp4 | 虽复楚有七泽                                                          |
| 459 | segment_000000468.mp4 | 人称三户                                                              |
| 460 | segment_000000469.mp4 | 箭不丽于六,箭不丽于六廉                                               |
| 461 | segment_000000470.mp4 | 雷无惊于九虎,辞洞庭兮落木                                             |
| 462 | segment_000000471.mp4 | 去浴阳兮极浦,去淡阳兮极浦,去岑阳兮极浦                                |
| 463 | segment_000000472.mp4 | 炽火兮楚旗,贞风兮害蛊,万使玉轴扬灰                                    |
| 464 | segment_000000473.mp4 | 龙文折柱                                                              |
| 465 | segment_000000474.mp4 | 下江余城                                                              |
| 466 | segment_000000475.mp4 | 长林故营                                                              |
| 467 | segment_000000476.mp4 | 徒思马之秣,徒思马之袜                                                 |
| 468 | segment_000000477.mp4 | 未见烧牛之兵                                                          |
| 469 | segment_000000478.mp4 | 章曼支毂走                                                            |
| 470 | segment_000000479.mp4 | 宫之奇V族行                                                           |
| 471 | segment_000000480.mp4 | 河无冰而马渡,关未晓而鸡鸣                                             |
| 472 | segment_000000481.mp4 | 忠臣解骨                                                              |
| 473 | segment_000000482.mp4 | 君子吞声                                                              |
| 474 | segment_000000483.mp4 | 章华望祭之所                                                          |
| 475 | segment_000000484.mp4 | 云梦伪游之地                                                          |
| 476 | segment_000000485.mp4 | 荒谷于莫教                                                            |
| 477 | segment_000000486.mp4 | 冶父凶于群帅,治父凶于群帅                                             |
| 478 | segment_000000487.mp4 | 研穿折拉,鹰批攒                                                       |
| 479 | segment_000000488.mp4 | 冤霜夏零                                                              |
| 480 | segment_000000489.mp4 | 愤泉秋沸                                                              |
| 481 | segment_000000490.mp4 | 城崩杞妇之哭,竹染湘之泪                                               |
| 482 | segment_000000491.mp4 | 水毒秦泾                                                              |
| 483 | segment_000000492.mp4 | 山高赵隆,山高赵际                                                     |
| 484 | segment_000000493.mp4 | 十里五里,长亭短亭,饥随蛰燕,暗逐流萤                                   |
| 485 | segment_000000494.mp4 | 秦中水黑                                                              |
| 486 | segment_000000495.mp4 | 关上泥青                                                              |
| 487 | segment_000000496.mp4 | 于時瓦解冰伴                                                          |
| 488 | segment_000000497.mp4 | 风飞电散                                                              |
| 489 | segment_000000498.mp4 | 潭然千里                                                              |
| 490 | segment_000000499.mp4 | 淄通一乱,淄绳一乱                                                     |
| 491 | segment_000000500.mp4 | 雪暗如沙                                                              |
| 492 | segment_000000501.mp4 | 冰横似岸                                                              |
| 493 | segment_000000502.mp4 | 逢赴洛之陆机                                                          |
| 494 | segment_000000503.mp4 | 见离家之王乐                                                          |
| 495 | segment_000000504.mp4 | 莫不闻陇水而掩泣                                                      |
| 496 | segment_000000505.mp4 | 向关山而长叹                                                          |
| 497 | segment_000000506.mp4 | 况复君在交河                                                          |
| 498 | segment_000000507.mp4 | 妾在青波                                                              |
| 499 | segment_000000508.mp4 | 石望夫而逾远                                                          |
| 500 | segment_000000509.mp4 | 山望子而逾多                                                          |
| 501 | segment_000000510.mp4 | 才人之忆代郡                                                          |
| 502 | segment_000000511.mp4 | 公主之去清河                                                          |
| 503 | segment_000000512.mp4 | 栩阳亭有离别之赋,临江王有愁思之歌                                     |
| 504 | segment_000000513.mp4 | 别有飄飘武威                                                          |
| 505 | segment_000000514.mp4 | 旅金微,羁旅金微                                                       |
| 506 | segment_000000515.mp4 | 班超生而望返                                                          |
| 507 | segment_000000516.mp4 | 温序死而思归                                                          |
| 508 | segment_000000517.mp4 | 李陵之双永去,李陵之双兔永去                                           |
| 509 | segment_000000518.mp4 | 苏武之一雁空飞                                                        |
| 510 | segment_000000519.mp4 | 若江陵之中否                                                          |
| 511 | segment_000000520.mp4 | 万金陵之祸始                                                          |
| 512 | segment_000000521.mp4 | 虽借人之力,虽借人之外力                                               |
| 513 | segment_000000522.mp4 | 实萧墙之内起                                                          |
| 514 | segment_000000523.mp4 | 拔乱之主忽焉,拨乱之主忽焉                                             |
| 515 | segment_000000524.mp4 | 中兴之宗不祀                                                          |
| 516 | segment_000000525.mp4 | 伯兮叔兮                                                              |
| 517 | segment_000000526.mp4 | 同见戮于犹子                                                          |
| 518 | segment_000000527.mp4 | 荆山鹊飞而玉碎                                                        |
| 519 | segment_000000528.mp4 | 隋岸蛇生而珠死                                                        |
| 520 | segment_000000529.mp4 | 鬼火乱于平林                                                          |
| 521 | segment_000000530.mp4 | 殇魂游于新市                                                          |
| 522 | segment_000000531.mp4 | 梁故丰徙                                                              |
| 523 | segment_000000532.mp4 | 楚实秦亡                                                              |
| 524 | segment_000000533.mp4 | 不有所废                                                              |
| 525 | segment_000000534.mp4 | 其何v昌,其何r昌                                                       |
| 526 | segment_000000535.mp4 | 有好之后                                                              |
| 527 | segment_000000536.mp4 | 将育于姜                                                              |
| 528 | segment_000000537.mp4 | 输我神器                                                              |
| 529 | segment_000000538.mp4 | 居为让王                                                              |
| 530 | segment_000000539.mp4 | 天地之大德日生                                                        |
| 531 | segment_000000540.mp4 | 圣人之大宝日位                                                        |
| 532 | segment_000000541.mp4 | 用无赖之子弟                                                          |
| 533 | segment_000000542.mp4 | 举江东而全弃                                                          |
| 534 | segment_000000543.mp4 | 惜天下之一家                                                          |
| 535 | segment_000000544.mp4 | 遭东南之反气,曹东南之反气                                             |
| 536 | segment_000000545.mp4 | 鹊首而赐秦,v鹊首而赐秦,r鹊首而赐秦,鹑首而赐秦                         |
| 537 | segment_000000546.mp4 | 天何为而此醉                                                          |
| 538 | segment_000000547.mp4 | 且夫天道回旋                                                          |
| 539 | segment_000000548.mp4 | 生民预焉                                                              |
| 540 | segment_000000549.mp4 | 余烈祖于西晋                                                          |
| 541 | segment_000000550.mp4 | 始流播于东川,始流播丁东川                                             |
| 542 | segment_000000551.mp4 | 泊余身而七叶                                                          |
| 543 | segment_000000552.mp4 | 又遭時而北迁                                                          |
| 544 | segment_000000553.mp4 | 提老幼                                                                |
| 545 | segment_000000554.mp4 | 关河累年                                                              |
| 546 | segment_000000555.mp4 | 死生契阔                                                              |
| 547 | segment_000000556.mp4 | 不可问天                                                              |
| 548 | segment_000000557.mp4 | 况复零落将尽                                                          |
| 549 | segment_000000558.mp4 | 灵光猫然,灵光拍然                                                     |
| 550 | segment_000000559.mp4 | 日穷于纪                                                              |
| 551 | segment_000000560.mp4 | 岁将复始                                                              |
| 552 | segment_000000561.mp4 | 逼切危虑                                                              |
| 553 | segment_000000562.mp4 | 端忧暮齿                                                              |
| 554 | segment_000000563.mp4 | 践长乐之神皋                                                          |
| 555 | segment_000000564.mp4 | 望宣平之贵里                                                          |
| 556 | segment_000000565.mp4 | 渭水贯于天门                                                          |
| 557 | segment_000000566.mp4 | 驹山回于地市,丽山回于地市                                             |
| 558 | segment_000000567.mp4 | 幕府大将军之爱客                                                      |
| 559 | segment_000000568.mp4 | 丞相平津侯之待士                                                      |
| 560 | segment_000000569.mp4 | 见钟鼎于金张                                                          |
| 561 | segment_000000570.mp4 | 闻弦歌于许史                                                          |
| 562 | segment_000000571.mp4 | 岂知灞陵夜措                                                          |
| 563 | segment_000000572.mp4 | 犹是故时将军,犹是故時将军                                             |
| 564 | segment_000000573.mp4 | 咸阳布衣                                                              |
| 565 | segment_000000574.mp4 | 非独思归王子                                                          |

vim run_caption.py

import os
import json
from tqdm import tqdm
import soundfile as sf
import torch
from transformers import Qwen2_5OmniForConditionalGeneration, Qwen2_5OmniProcessor
from qwen_omni_utils import process_mm_info

# Create output directory if it doesn't exist
output_dir = "Lament_for_the_South_Omni_3B"
os.makedirs(output_dir, exist_ok=True)

# Initialize model and processor
model = Qwen2_5OmniForConditionalGeneration.from_pretrained(
    "Qwen/Qwen2.5-Omni-3B",
    torch_dtype=torch.bfloat16,
    device_map="auto",
    attn_implementation="flash_attention_2",
)
processor = Qwen2_5OmniProcessor.from_pretrained("Qwen/Qwen2.5-Omni-3B")

# Set use audio in video
USE_AUDIO_IN_VIDEO = True

# Get all .mp4 files in the input directory
input_dir = "Lament_for_the_South"
video_files = [f for f in os.listdir(input_dir) if f.endswith('.mp4')]

# Process each video file
for video_file in tqdm(video_files, desc="Processing videos"):
    try:
        # Create conversation template for this video
        conversation = [
            {
                "role": "system",
                "content": [
                    {"type": "text", "text": "你是一个Video Captioner,根据我给你的视频生成对应的中文 Caption。不要回复其他内容，也不要进行其他询问。"}
                ],
            },
            {
                "role": "user",
                "content": [
                    {"type": "video", "video": os.path.join(input_dir, video_file)},
                    {"type": "text", "text": '''
                    使用中文描述这个视频中间的字是什么(也可以结合语音)，不要包含一闪而过的字幕，不要回复其他内容。回复的格式符合下面的json结构
                    ```json
                    {
                        "字幕": ...
                    }
                    ```
                    '''
                    }
                ],
            },
        ]

        # Preparation for inference
        text = processor.apply_chat_template(conversation, add_generation_prompt=True, tokenize=False)
        audios, images, videos = process_mm_info(conversation, use_audio_in_video=USE_AUDIO_IN_VIDEO)
        inputs = processor(text=text, audio=audios, images=images, videos=videos, return_tensors="pt", padding=True, use_audio_in_video=USE_AUDIO_IN_VIDEO)
        inputs = inputs.to(model.device).to(model.dtype)

        # Inference: Generation of the output text
        text_ids = model.generate(**inputs, use_audio_in_video=USE_AUDIO_IN_VIDEO, return_audio=False)

        # Process output
        text = processor.batch_decode(text_ids, skip_special_tokens=True, clean_up_tokenization_spaces=False)
        result = json.loads(text[0].split("assistant")[-1].strip().replace("json", "").replace("```", ""))

        # Save result as JSON
        output_file = os.path.join(output_dir, os.path.splitext(video_file)[0] + '.json')
        with open(output_file, 'w', encoding='utf-8') as f:
            json.dump(result, f, ensure_ascii=False, indent=2)

    except Exception as e:
        tqdm.write(f"Error processing {video_file}: {str(e)}")
        continue

print("Processing complete!")


import json
import shutil
from pathlib import Path

def process_folders(base_dir):
    # 定义路径对象
    base_path = Path(base_dir)
    mp4_dir = base_path / "Lament_for_the_South"
    json_dir = base_path / "Lament_for_the_South_Omni_3B"

    # 目标目录路径
    output_dir = base_path / "Lament_for_the_South_Omni_3B_Captioned"
    output_dir.mkdir(exist_ok=True)  # 创建目标目录

    # 查找所有json文件
    json_files = list(json_dir.glob("*.json"))

    for json_file in json_files:
        # 读取json文件内容
        try:
            with open(json_file, 'r', encoding='utf-8') as f:
                data = json.load(f)
                subtitle = data.get("字幕", "")

                # 生成对应的txt文件名
                txt_filename = f"{json_file.stem}.txt"
                txt_path = output_dir / txt_filename

                # 写入字幕内容到txt文件
                with open(txt_path, 'w', encoding='utf-8') as txt_file:
                    txt_file.write(subtitle)

                # 查找对应的mp4文件
                mp4_filename = f"{json_file.stem.replace('_Omni_3B', '')}.mp4"
                mp4_path = mp4_dir / mp4_filename

                # 拷贝mp4文件到目标目录
                if mp4_path.exists():
                    shutil.copy2(mp4_path, output_dir / mp4_filename)
                    print(f"Processed: {mp4_filename} with subtitle")
                else:
                    print(f"Warning: MP4 file not found for {json_file.name}")

        except json.JSONDecodeError:
            print(f"Error: Invalid JSON in file {json_file.name}")
        except Exception as e:
            print(f"Error processing {json_file.name}: {str(e)}")

# 使用示例
if __name__ == "__main__":
    base_directory = "."
    process_folders(base_directory)
    print("处理完成！")

import json
import shutil
from pathlib import Path
from moviepy.editor import AudioFileClip
import os

def convert_mp4_to_mp3(mp4_path, mp3_path):
    """将MP4文件转换为MP3音频文件"""
    try:
        audio = AudioFileClip(str(mp4_path))
        audio.write_audiofile(str(mp3_path))
        audio.close()
        return True
    except Exception as e:
        print(f"Error converting {mp4_path.name} to MP3: {str(e)}")
        return False

def process_folders(base_dir):
    # 定义路径对象
    base_path = Path(base_dir)
    mp4_dir = base_path / "Lament_for_the_South"
    json_dir = base_path / "Lament_for_the_South_Omni_3B"

    # 目标目录路径
    output_dir = base_path / "Lament_for_the_South_MP3_Omni_3B_Captioned"
    output_dir.mkdir(exist_ok=True)

    # 临时目录用于存储转换的MP3文件
    temp_mp3_dir = base_path / "temp_mp3"
    temp_mp3_dir.mkdir(exist_ok=True)

    # 查找所有json文件
    json_files = list(json_dir.glob("*.json"))

    for json_file in json_files:
        try:
            # 读取json文件内容
            with open(json_file, 'r', encoding='utf-8') as f:
                data = json.load(f)
                subtitle = data.get("字幕", "")

                # 生成对应的txt文件名
                txt_filename = f"{json_file.stem}.txt"
                txt_path = output_dir / txt_filename

                # 写入字幕内容到txt文件
                with open(txt_path, 'w', encoding='utf-8') as txt_file:
                    txt_file.write(subtitle)

                # 查找对应的mp4文件
                mp4_filename = f"{json_file.stem.replace('_Omni_3B', '')}.mp4"
                mp4_path = mp4_dir / mp4_filename

                if mp4_path.exists():
                    # 生成对应的mp3文件名
                    mp3_filename = f"{json_file.stem.replace('_Omni_3B', '')}.mp3"
                    temp_mp3_path = temp_mp3_dir / mp3_filename
                    final_mp3_path = output_dir / mp3_filename

                    # 转换MP4为MP3
                    if convert_mp4_to_mp3(mp4_path, temp_mp3_path):
                        # 移动MP3文件到最终目录
                        shutil.move(str(temp_mp3_path), str(final_mp3_path))
                        print(f"Processed: {mp4_filename} -> {mp3_filename} with subtitle")
                    else:
                        print(f"Failed to convert {mp4_filename} to MP3")
                else:
                    print(f"Warning: MP4 file not found for {json_file.name}")

        except json.JSONDecodeError:
            print(f"Error: Invalid JSON in file {json_file.name}")
        except Exception as e:
            print(f"Error processing {json_file.name}: {str(e)}")

    # 清理临时目录
    try:
        shutil.rmtree(temp_mp3_dir)
    except:
        pass

if __name__ == "__main__":
    # 安装依赖库 (如果尚未安装)
    try:
        from moviepy.editor import AudioFileClip
    except ImportError:
        print("Installing required packages...")
        os.system("pip install moviepy")

    base_directory = "."
    process_folders(base_directory)
    print("处理完成！")
